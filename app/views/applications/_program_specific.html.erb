

<%= simple_form_for @application, url: {action: "program_specific" } do |f| %>
  <strong>ADDING</strong>
  
   <%= f.input :id, as: :hidden %>
   <%= f.input :program_specific, as: :hidden, input_html: {value: true} %>

  <%= f.simple_fields_for :applicationcustomtemplates, @application.applicationcustomtemplates.build  do |builder| %>

 
  <%= builder.input :customtemplate_id, as: :hidden, input_html: { value: @ps.id } %> 

    
    <% @ps.customfields.each do |cf| %>

             
        <%= builder.simple_fields_for :customfieldvalues, 
        @application.applicationcustomtemplates.build.customfieldvalues.build  do |val| %>


        <% if cf.field_type == "input_text" %>

          <%= val.input :applicationcustomtemplate_id, as: :hidden, input_html: { value: @application.applicationcustomtemplates.first.id} %>
          <%= val.input :user_id, as: :hidden, input_html: { value: current_user.id } %>    
          <%= val.input :customfield_id, as: :hidden,  input_html: {value: cf.id} %> 
          
          <% if !cf.customfieldvalues.where(:applicationcustomtemplate_id=>@application.applicationcustomtemplates.first.id).blank? %>
            <%= val.input :value, label: cf.field_label, input_html: {
            value: cf.customfieldvalues.where(
              "customfield_id=? AND applicationcustomtemplate_id=?", cf.id, @application.applicationcustomtemplates.first.id).first.value } %>  
          <% else %>    
            <%= val.input :value, label: cf.field_label %>
          <% end %>

          <%#= @application.applicationcustomtemplates.first.id rescue nil %>
          
        <% end %>

        <% if cf.field_type == "boolean" %>
       
        <%= val.input :applicationcustomtemplate_id, as: :hidden, input_html: { value: @application.applicationcustomtemplates.first.id} %>
        <%= val.input :user_id,as: :hidden, input_html: { value: current_user.id } %>    
        <%= val.input :customfield_id,as: :hidden, input_html: {value: cf.id } %> 

        
          <% if cf.customfieldvalues.where(:applicationcustomtemplate_id=>@application.applicationcustomtemplates.first.id).blank? %>
            <%= val.input :value, as: :radio_buttons %>
          <% else %>
            <% if cf.customfieldvalues.where(
              "customfield_id=? AND applicationcustomtemplate_id=?", cf.id, @application.applicationcustomtemplates.first.id).first.value == "true" %>
              <%= val.input :value, label: cf.field_label,  as: :radio_buttons,  checked: true %>
            <% else %>
              <%= val.input :value, label: cf.field_label, as: :radio_buttons, checked: false %>
            <% end %>
          <% end %>
      
      <% end %>

  <% end %> 
  <% end %>
  <% end %>
  

   <%= f.button :submit, "Verify eligibility", name: "verify" %>

   <% if @application.errors.blank? %>
    <%= f.button :submit, "Save", name: "save" %>
   <% end %>

   <%= f.button :submit, "Previous", name: "previous" %>

<% end %>

